from xml.etree.ElementTree import Element, SubElement, ElementTree
import xml.dom.minidom
import uuid  # 引入uuid模塊，用於生成有效的UUID

# 創建根元素，設置其版本為1.0
root = Element('plist', version='1.0')

# 在根元素下創建dict元素
_dict = SubElement(root, 'dict')

# 添加基本的Payload信息
SubElement(_dict, 'key').text = 'PayloadDisplayName'
SubElement(_dict, 'string').text = '🇺🇲 美国 03'

SubElement(_dict, 'key').text = 'PayloadIdentifier'
SubElement(_dict, 'string').text = 'com.example.vpn'  # 使用唯一的標識符

SubElement(_dict, 'key').text = 'PayloadType'
SubElement(_dict, 'string').text = 'Configuration'

# 生成一個有效的UUID
new_uuid = str(uuid.uuid4())

# 使用生成的有效UUID
SubElement(_dict, 'key').text = 'PayloadUUID'
SubElement(_dict, 'string').text = new_uuid

SubElement(_dict, 'key').text = 'PayloadVersion'
SubElement(_dict, 'integer').text = '1'

# 添加VPN配置信息
SubElement(_dict, 'key').text = 'VPNType'
SubElement(_dict, 'string').text = 'IPSec'  # 使用iOS支持的VPN類型

SubElement(_dict, 'key').text = 'ServerAddress'
SubElement(_dict, 'string').text = '2pwiyzakfjnmvikqu7la.wgetapi.com'

SubElement(_dict, 'key').text = 'ServerPort'
SubElement(_dict, 'integer').text = '4046'

SubElement(_dict, 'key').text = 'Password'
SubElement(_dict, 'string').text = 'da06745f-bc5b-3d1a-83e8-689d747deda1'

SubElement(_dict, 'key').text = 'SNI'
SubElement(_dict, 'string').text = '92zpkcdwze29gaqizktn.appletls.com'

SubElement(_dict, 'key').text = 'SkipCertVerify'
SubElement(_dict, 'true')  # 正確的方式來設置布爾值

# 創建ElementTree對象並寫入文件
tree = ElementTree(root)

# 格式化輸出XML字符串
xml_str = xml.dom.minidom.parseString(ElementTree.tostring(root)).toprettyxml(indent="   ")

# 將格式化的XML字符串保存到.mobileconfig文件中
with open("trojan_vpn_config.mobileconfig", "w") as f:
    f.write(xml_str)
